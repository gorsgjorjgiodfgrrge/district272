(function(){async function loadFirebase(){const loadScript=src=>new Promise(((resolve,reject)=>{const script=document.createElement("script");script.src=src;script.onload=resolve;script.onerror=()=>reject(new Error(`Failed to load script: ${src}`));document.head.appendChild(script)}));try{await loadScript("https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js");await loadScript("https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js")}catch(error){console.error("Error loading Firebase scripts:",error);throw error}}const firebaseConfig={prod:{apiKey:"AIzaSyA9FrPIX08nAnq-JxQxQhBU7r7CMqiPwWY",authDomain:"prod1-ai.firebaseapp.com",projectId:"prod1-ai",storageBucket:"prod1-ai.appspot.com",messagingSenderId:"829260107773",appId:"1:829260107773:web:adc187640f19d2c8da1394"}};const config={apiHost:"",characterDetails:{},apiKey:"",containerSelector:"",position:"bottom-right",isMobile:false,isMobileLg:false,firebase:null,accessToken:null,isChatLimitExceeded:false,userId:null,sessionInfo:{},shouldHideOnClose:false};async function reportEvent(payload){try{const feOsName=getOsName();const feDeviceType=config.isMobile?"mobile":"desktop";const utmCampaign="NA";const utmSource="NA";const utmMedium="NA";const pageReferrer=document.referrer||"NA";const characterId=config?.characterDetails?.characterId;const chatSessionId=config.sessionInfo?.body?.chatSessionId;const userId=config.userId;const isContextual=config?.characterDetails?.isContextual;const wsupUaId=localStorage.getItem("wsup_uaId")||"NA";if(!payload.extraData){payload.extraData={}}payload.extraData.isContextual=isContextual;const response=await fetch(`${config.apiHost}/ai/api/stats/v1/reportEvent`,{method:"POST",headers:{"Content-Type":"application/json",client:"embed-widget","x-api-key":"taYoz9eEUOSPanimhFCNsTI7BVnG4pIS"},body:JSON.stringify({...payload,pageReferrer:pageReferrer,feOsName:feOsName,feDeviceType:feDeviceType,client:"embed-widget",utmCampaign:utmCampaign,utmSource:utmSource,utmMedium:utmMedium,characterId:characterId,chatSessionId:chatSessionId,userId:userId,wsupUaId:wsupUaId})});if(!response.ok){console.error(`Failed to report event ${eventName}: ${response.status}`)}}catch(error){console.error(`Error reporting event ${eventName}:`,error)}}const scriptTag=document.currentScript;if(scriptTag){config.containerSelector=scriptTag.getAttribute("data-container-css-selector")||config.containerSelector;config.shouldHideOnClose=scriptTag.getAttribute("data-cls-en")==="true";config.isMobileLg=scriptTag.getAttribute("data-mobile-lg")==="true";config.partner=scriptTag.getAttribute("data-partner")||""}function getFirebaseConfig(){return firebaseConfig.prod}async function initFirebaseAuth(performLogin=false){try{const fbConfig=getFirebaseConfig();if(!config.firebase){config.firebase=firebase.initializeApp(fbConfig)}const auth=config.firebase.auth();return new Promise(((resolve,reject)=>{const unsubscribe=auth.onAuthStateChanged((async user=>{unsubscribe();if(user){console.log("User is already signed in");config.accessToken=await user.getIdToken();config.userId=user.uid;resolve(config.accessToken)}else if(performLogin){try{const userCredential=await auth.signInAnonymously();config.accessToken=await userCredential.user.getIdToken();config.userId=userCredential.user.uid;console.log("Anonymous sign-in successful, token acquired");resolve(config.accessToken)}catch(error){console.error("Error signing in anonymously:",error);reject(error)}}else{console.log("No user found and not performing login");resolve(null)}}),(error=>{console.error("Error checking auth state:",error);reject(error)}))}))}catch(error){console.error("Error initializing Firebase authentication:",error);return null}}async function fetchCharacterDetails(){try{if(!config.apiHost){console.error("Missing required config for fetchCharacterDetails: apiHost");return null}const{pageTitle:pageTitle,pageDescription:pageDescription}=await fetchPageMetadataWithRetry();const response=await fetch(`${config.apiHost}/ai/api/char/v2/embeddableCharacter`,{method:"POST",headers:{"Content-Type":"application/json",client:"embed-widget","x-api-key":"taYoz9eEUOSPanimhFCNsTI7BVnG4pIS"},body:JSON.stringify({pageUrl:window.location.origin+window.location.pathname,pageTitle:pageTitle||document.title||"NA",pageDescription:pageDescription||"NA"})});if(!response.ok){const errorText=await response.text().catch((()=>"Unknown error"));const errorMessage=`Failed to fetch character ID: ${response.status} - ${errorText}`;throw new Error(errorMessage)}const data=await response.json();if(data?.status==="Success"&&data?.body){config.characterDetails={characterId:data.body.id,characterName:data.body.name,characterImageUrl:optimizeImageUrl(data.body.characterImageUrl),characterImageUrlOriginal:data.body.characterImageUrl,greetingMessage:data.body.greetingMsg,isContextual:data.body.isContextual,description:data.body.description};return config.characterDetails}throw new Error(`Failed to get character ID: ${data?.status||"Unknown status"}`)}catch(error){console.error("Error fetching character ID:",error);return null}}function checkMobile(){return window.innerWidth<=768}function injectFont(){if(document.querySelector('link[href*="Rubik"]')){return}const fontLink=document.createElement("link");fontLink.href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;600&display=swap";fontLink.rel="stylesheet";document.head.appendChild(fontLink)}const styles=`\n    .now-ai-chat-widget {\n      position: fixed;\n      z-index: 2147483647;\n      display: flex;\n      flex-direction: column;\n      width: 268px;\n      height: 480px;\n      border-radius: 12px;\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n      transition: all 0.3s ease;\n      overflow: hidden;\n      border-radius: 24px;\n      border: 2px solid #82A1FF;\n      box-shadow: -4px -4px 64px 0px #000;\n      background: var(--character-avatar-url);\n      background-size: cover;\n      background-position: center top;\n      background-color: #171717;\n      font-family: 'Rubik', sans-serif;\n      box-sizing: border-box;\n      transition: background-image 0.5s ease-in-out;\n    }\n\n    .now-ai-online-status {\n      position: absolute;\n      bottom: -4px;\n      left: 50%;\n      transform: translateX(-50%);\n      background-color: rgba(0, 0, 0, 0.1);\n      color: white;\n      font-size: 10px;\n      padding: 3px 8px;\n      border-radius: 12px;\n      opacity: 0;\n      transition: all 0.3s ease;\n      pointer-events: none;\n      white-space: nowrap;\n      font-weight: 600;\n      z-index: 1;\n      display: flex;\n      align-items: center;\n    }\n\n    .now-ai-online-dot {\n      display: inline-block;\n    }\n\n    .now-ai-online-text {\n      display: inline-block;\n    }\n\n    .now-ai-online-status.show {\n      opacity: 1;\n      bottom: 0px;\n    }\n\n    .now-ai-chat-widget:not(.collapsed):not(.super-collapsed) .now-ai-online-status {\n      display: none;\n    }\n\n    .now-ai-chat-widget.collapsed .now-ai-online-status.show,\n    .now-ai-chat-widget.super-collapsed .now-ai-online-status.show {\n      opacity: 1;\n      bottom: 0px;\n      display: flex;\n    }\n\n    .now-ai-collapsed-close {\n      position: absolute;\n      top: -8px;\n      right: -8px;\n      width: 16px;\n      height: 16px;\n      border-radius: 50px;\n      border: 1px solid #82A1FF;\n      background: #171717;\n      backdrop-filter: blur(32px);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      cursor: pointer;\n      transition: opacity 0.3s ease;\n      z-index: 20001;\n      opacity: 0;\n      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n    }\n\n    @media (min-width: 769px) {\n      .now-ai-collapsed-close {\n        display: none !important;\n      }\n    }\n\n    .now-ai-collapsed-close svg {\n      width: 10px;\n      height: 10px;\n      fill: none;\n      stroke: #FFFFFF;\n      stroke-width: 2;\n      stroke-linecap: round;\n      stroke-linejoin: round;\n    }\n\n\n    .now-ai-chat-bubble {\n      position: absolute;\n      top: -42px;\n      right: 36px;\n      background-color: #FFF;\n      border: none;\n      border-radius: 8px;\n      padding: 8px 10px;\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      opacity: 0;\n      transform: scale(0);\n      transform-origin: bottom right;\n      transition: all 0.3s cubic-bezier(0.19, 1, 0.22, 1);\n      z-index: 20000;\n      pointer-events: none;\n      width: 92px;\n      max-width: 92px;\n      max-height: auto;\n      box-shadow: -4px -4px 10px 0px rgba(0, 0, 0, 0.50);\n    }\n\n    .now-ai-bubble-content {\n      display: flex;\n      flex-direction: column;\n      width: 100%;\n      overflow: hidden;\n    }\n\n    .now-ai-bubble-character-name {\n      font-weight: bold;\n      margin-bottom: 2px;\n      color: #0397EB;\n      white-space: nowrap;\n      text-overflow: ellipsis;\n      overflow: hidden;\n      font-size: 10px;\n    }\n\n    .now-ai-bubble-greeting {\n      color: rgba(0, 0, 0, 0.80);\n      display: -webkit-box;\n      -webkit-line-clamp: 2;\n      -webkit-box-orient: vertical;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      font-weight: 600;\n      line-height: 125%;\n      letter-spacing: 0.2px;\n      font-size: 10px;\n    }\n\n    .now-ai-chat-bubble::after {\n      content: '';\n      position: absolute;\n      bottom: -14px;\n      right: 13px;\n      width: 0px;\n      height: 0px;\n      border-left: 40px solid transparent;\n      border-right: 0px solid transparent;\n      border-top: 20px solid #FFF;\n      z-index: 1;\n    }\n\n    .now-ai-chat-bubble.show {\n      opacity: 1;\n      transform: scale(1);\n    }\n\n    .now-ai-chat-bubble.show ~ .now-ai-online-status .now-ai-online-text,\n    .now-ai-chat-bubble.show ~ .now-ai-online-status .now-ai-online-dot {\n      display: none;\n    }\n\n    .now-ai-chat-widget:not(.collapsed):not(.super-collapsed) .now-ai-chat-bubble {\n      display: none;\n    }\n\n    .now-ai-chat-widget.collapsed {\n      width: 56px;\n      height: 90px;\n      padding: 0;\n      border-radius: 12px;\n      overflow: visible;\n      background: none;\n      border: none;\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);\n      border: 1px solid #82A1FF;\n    }\n\n    .now-ai-chat-widget.bottom-left {\n      bottom: 20px;\n      left: 20px;\n      border-radius: 12px;\n      animation: fadeIn 0.3s ease-out;\n    }\n\n    .now-ai-chat-widget.bottom-right {\n      bottom: 20px;\n      right: 20px;\n      border-radius: 12px;\n      animation: fadeIn 0.3s ease-out;\n      transition: all 0.3s cubic-bezier(0.19, 1, 0.22, 1);\n    }\n\n    .now-ai-chat-widget.collapsed.bottom-right {\n      animation: slideInRight 0.8s cubic-bezier(0.19, 1, 0.22, 1);\n      overflow: visible;\n    }\n\n    .now-ai-chat-widget.bottom-center {\n      bottom: 20px;\n      left: 50%;\n      transform: translateX(-50%);\n      border-radius: 12px;\n      animation: fadeIn 0.3s ease-out;\n    }\n\n    @keyframes slideInRight {\n      0% {\n        transform: translateX(100%);\n        opacity: 0;\n      }\n      70% {\n        transform: translateX(-10px);\n        opacity: 1;\n      }\n      85% {\n        transform: translateX(5px);\n      }\n      100% {\n        transform: translateX(0);\n      }\n    }\n\n    @keyframes fadeIn {\n      0% {\n        opacity: 0;\n      }\n      100% {\n        opacity: 1;\n      }\n    }\n\n    @keyframes pulse {\n      0% {\n        transform: scale(1);\n        box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.25);\n      }\n      50% {\n        transform: scale(1.05);\n        box-shadow: 0px 6px 8px 0px rgba(0, 0, 0, 0.3);\n      }\n      100% {\n        transform: scale(1);\n        box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.25);\n      }\n    }\n\n    /* Apply subtle animation to make the button more noticeable */\n    .now-ai-chat-widget.super-collapsed:not(:hover) {\n      animation: pulse 3s infinite ease-in-out;\n    }\n\n    .now-ai-chat-widget.collapsed .now-ai-chat-body,\n    .now-ai-chat-widget.collapsed .now-ai-chat-header .now-ai-header-info,\n    .now-ai-chat-widget.collapsed .now-ai-collapse-button,\n    .now-ai-chat-widget.collapsed .now-ai-minimize-button {\n      display: none;\n    }\n\n    .now-ai-chat-widget.collapsed .now-ai-chat-header {\n      border-bottom: none;\n      margin-bottom: 0;\n      padding: 0;\n      height: 100%;\n      width: 100%;\n    }\n\n    .now-ai-chat-widget.collapsed .now-ai-avatar {\n      width: 100%;\n      height: 100%;\n      margin: 0;\n      border-radius: 10px;\n      cursor: pointer;\n      border: none;\n      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);\n    }\n\n    .now-ai-collapsed-logo {\n      position: absolute;\n      top: -24px;\n      right: 0px;\n      z-index: 10000;\n      background: #4A3EC6;\n      padding: 0px 3px 6px 3px;\n      border: 1px solid rgba(255, 255, 255, 0.10);\n      display: none;\n      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);\n      border-top-left-radius: 8px;\n      border-top-right-radius: 8px;\n      z-index: -1;\n      opacity: 0;\n      transition: opacity 0.3s ease;\n    }\n\n    @media (max-width: 768px) {\n      .now-ai-collapsed-logo {\n        left: 0px;\n        right: auto;\n      }\n\n      .now-ai-chat-widget.mobile-lg .now-ai-collapsed-logo {\n        width: calc(100% - 8px);\n      }\n\n      .now-ai-chat-widget.mobile-lg .now-ai-collapsed-logo a {\n        text-align: center;\n      }\n\n      .now-ai-chat-widget.mobile-lg .now-ai-chat-bubble {\n        top: -64px;\n        right: 114px;\n      }\n    }\n\n    .now-ai-chat-widget.collapsed:not(.super-collapsed) .now-ai-collapsed-logo.show {\n      display: block;\n      opacity: 1;\n    }\n\n    .now-ai-collapsed-logo img {\n      height: 10.5px;\n      width: auto;\n    }\n\n    .now-ai-collapsed-logo a {\n      cursor: pointer;\n      transition: opacity 0.2s ease;\n    }\n\n    .now-ai-collapsed-logo a:hover {\n      opacity: 0.8;\n    }\n\n    .now-ai-chat-header {\n      padding-left: 10px;\n      padding-top: 6px;\n      color: white;\n      display: flex;\n      cursor: pointer;\n      position: relative;\n      align-items: center;\n    }\n\n    .now-ai-chat-widget:not(.collapsed):not(.super-collapsed) .now-ai-chat-header {\n      background: linear-gradient(rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0));\n    }\n\n    .now-ai-header-top {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      margin-bottom: 8px;\n    }\n\n    .now-ai-header-info {\n      display: flex;\n      flex-direction: column;\n    }\n\n    .now-ai-avatar {\n      width: 40px;\n      height: 40px;\n      border-radius: 50%;\n      margin-right: 8px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-size: 12px;\n      color: white;\n      object-fit: cover;\n      object-position: top;\n      transition: opacity 0.3s ease-in-out;\n      background-color: #333;\n    }\n\n    .now-ai-chat-header-title {\n      font-weight: 600;\n      font-size: 16px;\n      max-width: 145px;\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n\n    .now-ai-powered-by {\n      font-size: 10px;\n      color: rgba(255, 255, 255, 0.80);\n      display: flex;\n      align-items: center;\n      margin-top: -3px;\n      margin-bottom: 4px;\n      font-weight: 600;\n      letter-spacing: 1.5px;\n    }\n\n    .now-ai-logo {\n      display: inline-flex;\n      align-items: center;\n      justify-content: center;\n      border-radius: 4px;\n      background: #4A3EC6;\n      padding: 1px 2px;\n      margin-left: 4px;\n    }\n\n    .now-ai-logo img {\n      height: 12px;\n      width: auto;\n      vertical-align: middle;\n    }\n\n    .now-ai-logo a {\n      cursor: pointer;\n      transition: opacity 0.2s ease;\n    }\n\n    .now-ai-logo a:hover {\n      opacity: 0.8;\n    }\n\n\n    .now-ai-collapse-button {\n      position: absolute;\n      top: 12px;\n      right: 10px;\n      width: 24px;\n      height: 24px;\n      border-radius: 50%;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      cursor: pointer;\n      transition: transform 0.3s ease, background-color 0.2s ease;\n    }\n\n    .now-ai-collapse-button:hover {\n      background-color: rgba(255, 255, 255, 0.2);\n    }\n\n    .now-ai-collapse-button svg {\n      width: 18px;\n      height: 18px;\n      fill: none;\n      stroke: white;\n      stroke-width: 2;\n      stroke-linecap: round;\n      stroke-linejoin: round;\n    }\n\n    .now-ai-minimize-button {\n      position: absolute;\n      top: 12px;\n      right: 35px;\n      width: 24px;\n      height: 24px;\n      border-radius: 50%;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      cursor: pointer;\n      transition: transform 0.3s ease, background-color 0.2s ease;\n    }\n\n    .now-ai-minimize-button:hover {\n      background-color: rgba(255, 255, 255, 0.2);\n    }\n\n    .now-ai-minimize-button svg {\n      width: 18px;\n      height: 18px;\n      fill: none;\n      stroke-width: 2;\n      stroke-linecap: round;\n      stroke-linejoin: round;\n    }\n\n\n    .now-ai-new-button {\n      position: absolute;\n      top: 10px;\n      right: 11px;\n      border-radius: 50%;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      cursor: pointer;\n      transition: transform 0.3s ease, background-color 0.2s ease;\n      background-color: rgba(255, 255, 255, 0.2);\n    }\n\n    .now-ai-new-button:hover {\n      background-color: rgba(255, 255, 255, 0.3);\n    }\n\n    .now-ai-chat-body {\n      flex: 1;\n      display: flex;\n      flex-direction: column;\n      overflow-y: auto;\n      padding: 12px 10px;\n      overflow-x: hidden;\n      position: relative;\n    }\n\n    .now-ai-chat-messages {\n      flex: 1;\n      overflow-y: auto;\n      overflow-x: hidden;\n      margin-bottom: 12px;\n      padding-right: 6px;\n      display: flex;\n      flex-direction: column;\n      min-height: 0;\n    }\n\n\n    .now-ai-chat-messages::before {\n      content: '';\n      flex: 1;\n      min-height: 0;\n    }\n\n    /* Custom scrollbar styles */\n    .now-ai-chat-body::-webkit-scrollbar,\n    .now-ai-chat-messages::-webkit-scrollbar {\n      width: 4px;\n      height: 57px;\n    }\n\n    .now-ai-chat-body::-webkit-scrollbar-track,\n    .now-ai-chat-messages::-webkit-scrollbar-track {\n      background: transparent;\n      margin: 4px;\n    }\n\n    .now-ai-chat-body::-webkit-scrollbar-thumb,\n    .now-ai-chat-messages::-webkit-scrollbar-thumb {\n      background: rgba(255, 255, 255, 0.30);\n      border-radius: 24px;\n      opacity: 0.4;\n    }\n\n    .now-ai-chat-body::-webkit-scrollbar-thumb:hover,\n    .now-ai-chat-messages::-webkit-scrollbar-thumb:hover {\n      background: rgba(255, 255, 255, 0.30);\n      opacity: 0.4;\n    }\n\n    /* Firefox scrollbar */\n    .now-ai-chat-body,\n    .now-ai-chat-messages {\n      scrollbar-width: thin;\n      scrollbar-color: rgba(255, 255, 255, 0.30) transparent;\n    }\n\n    .now-ai-message {\n      margin-bottom: 12px;\n      max-width: calc(80% - 4px);\n      padding: 10px 14px;\n      border-radius: 18px;\n      line-height: 1.4;\n      font-size: 14px;\n      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);\n      word-wrap: break-word;\n      overflow-wrap: break-word;\n      word-break: break-word;\n    }\n\n    .now-ai-message.faded {\n      opacity: 0.6;\n    }\n\n    .now-ai-user-message {\n      align-self: flex-end;\n      border-radius: 16px 16px 0px 16px;\n      background: #4A3EC6;\n      backdrop-filter: blur(32px);\n      color: white;\n      margin-left: auto;\n      width: fit-content;\n      margin-right: 4px;\n    }\n\n    .now-ai-bot-message {\n      align-self: flex-start;\n      border-radius: 16px 16px 16px 0px;\n      background: #393535;\n      box-shadow: 0px 8px 24px 0px rgba(0, 0, 0, 0.12);\n      backdrop-filter: blur(60px);\n      color: white;\n    }\n\n    .now-ai-description-message {\n      border-radius: 16px;\n      background: rgba(0, 0, 0, 0.90);\n      padding: 8px 12px;\n      margin-bottom: 16px;\n      width: 100%;\n      max-width:100%;\n      box-sizing: border-box;\n      align-self: center;\n    }\n\n    .now-ai-description-header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 8px;\n    }\n\n    .now-ai-description-title {\n      font-size: 14px;\n      font-weight: 600;\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      max-width: 64%;\n      color: rgba(255, 255, 255, 0.70);\n    }\n\n    .now-ai-read-more {\n      font-size: 12px;\n      font-weight: 500;\n      color: #FFC32A;\n      cursor: pointer;\n      transition: color 0.2s ease;\n      white-space: nowrap;\n    }\n\n    .now-ai-read-more:hover {\n      color: #82A1FF;\n    }\n\n    .now-ai-description-content {\n      font-size: 14px;\n      line-height: 1.4;\n      color: rgba(255, 255, 255, 0.50);\n      display: -webkit-box;\n      -webkit-line-clamp: 2;\n      -webkit-box-orient: vertical;\n      overflow: hidden;\n      text-overflow: ellipsis;\n      transition: all 0.3s ease;\n      position: relative;\n      font-style: italic;\n    }\n\n    .now-ai-description-content.expanded {\n      -webkit-line-clamp: unset;\n      max-height: none;\n    }\n\n    .now-ai-chat-input-container {\n      display: flex;\n      align-items: center;\n      gap: 10px;\n      padding: 0;\n      width: 100%;\n      box-sizing: border-box;\n    }\n\n    input[type="text"].now-ai-chat-input,\n    .now-ai-chat-input {\n      flex: 1;\n      padding: 10px 14px !important;\n      border-radius: 20px !important;\n      border: none !important;\n      background: #393535;\n      outline: none !important;\n      color: rgba(255, 255, 255, 0.8) !important;\n      font-size: 16px !important;\n      font-weight: 400 !important;\n      height: 40px !important;\n      resize: none !important;\n      max-height: 40px !important;\n      overflow-y: auto !important;\n      line-height: normal !important;\n      font-family: inherit !important;\n      position: relative !important;\n      min-width: 0 !important;\n      box-sizing: border-box !important;\n      width: auto !important;\n      margin: 0 !important;\n    }\n\n    .now-ai-chat-input::placeholder {\n      color: rgba(255, 255, 255, 0.4);\n      font-size: 14px;\n      font-weight: 400;\n      text-transform: capitalize;\n    }\n\n    .now-ai-chat-input:focus {\n      border-color: #82A1FF;\n    }\n\n    .now-ai-chat-input.disabled,\n    .now-ai-chat-submit.disabled {\n      background: rgba(0,0,0,0.10);\n      pointer-events: none;\n    }\n\n    .now-ai-wsup-container {\n      display: none;\n      align-items: center;\n      padding: 8px;\n      border-radius: 40px;\n      background: #3B3B3B;\n    }\n\n    .now-ai-wsup-container.active {\n      display: flex;\n      justify-content: space-between;\n    }\n\n    .now-ai-wsup-logo {\n      height: 20px;\n      padding-left: 8px;\n    }\n\n    .now-ai-continue-button {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      background: #4A3EC6;\n      color: #FFFFFF !important;\n      font-weight: 600;\n      border-radius: 24px;\n      cursor: pointer;\n      font-size: 12px;\n      transition: all 0.2s ease;\n      border: none;\n      text-decoration: none;\n      text-wrap-mode: nowrap;\n      padding: 8px 14px;\n    }\n\n    .now-ai-continue-button:hover {\n      background: #6b62d0;\n      color: #FFFFFF;\n    }\n\n    .now-ai-continue-button svg {\n      margin-left: 8px;\n    }\n\n    .now-ai-chat-input-container.hidden,\n    .now-ai-chat-submit.hidden {\n      display: none;\n    }\n\n\n    .now-ai-chat-submit {\n    width: 40px;\n    height: 40px;\n    min-width: 40px;\n    border-radius: 100%;\n    background-color: #4A3EC6;\n    flex-shrink: 0;\n    cursor: pointer;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    box-sizing: border-box;\n    border: none;\n  }\n\n  .now-ai-chat-submit img,\n  .now-ai-chat-submit svg {\n      width: 21px !important;\n      flex-shrink: 0;\n      height: 21px;\n  }\n  .now-ai-chat-submit:hover {\n     background-color: #6b62d0;\n  }\n\n   .now-ai-chat-submit:disabled,\n   .now-ai-chat-submit.disabled {\n     cursor: not-allowed;\n      pointer-events: none;\n      background-color: rgba(0,0,0,0.1);\n  }\n\n    .now-ai-chat-button {\n      width: 60px;\n      height: 60px;\n      border-radius: 50%;\n      background: #4a5568;\n      color: white;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      cursor: pointer;\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n      position: relative;\n      z-index: 1;\n    }\n\n    .now-ai-chat-button i {\n      font-size: 24px;\n    }\n\n    .now-ai-hidden {\n      display: none !important;\n    }\n\n    .now-ai-typing-indicator {\n      display: none;\n      align-self: flex-start;\n      border-radius: 16px 16px 16px 16px;\n      background: #393535;\n      box-shadow: 0px 8px 24px 0px rgba(0, 0, 0, 0.12);\n      backdrop-filter: blur(60px);\n      color: rgba(255, 255, 255, 0.60);\n      padding: 10px 14px;\n      margin-bottom: 12px;\n      max-width: 80%;\n    }\n\n    .now-ai-typing-indicator.active {\n      display: flex;\n      align-items: center;\n    }\n\n    .now-ai-typing-text {\n      margin-right: 8px;\n      font-size: 10px;\n      font-weight: 500;\n      white-space: nowrap;\n    }\n\n    .now-ai-bouncing-dots {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      gap: 4px;\n    }\n\n    .now-ai-dot {\n      width: 4px;\n      height: 4px;\n      background-color: white;\n      border-radius: 50%;\n      animation: bounce 1.2s infinite ease-in-out;\n    }\n\n    .now-ai-bubble-dot {\n    background-color: black;\n    }\n\n    .now-ai-dot:nth-child(1) {\n      animation-delay: 0s;\n    }\n\n    .now-ai-dot:nth-child(2) {\n      animation-delay: 0.2s;\n    }\n\n    .now-ai-dot:nth-child(3) {\n      animation-delay: 0.4s;\n    }\n\n    @keyframes bounce {\n      0%, 80%, 100% {\n        transform: translateY(0);\n      }\n      40% {\n        transform: translateY(-5px);\n      }\n    }\n\n    @media (max-width: 768px) {\n      .now-ai-chat-widget {\n        width: 100%;\n        max-width: 100%;\n        height: 75vh;\n        left: 0;\n        right: 0;\n        margin: 0;\n        bottom: 0;\n        border-radius: 16px 16px 0 0;\n        max-height: 75vh;\n        border-left: none;\n        border-right: none;\n        border-bottom: none;\n        padding: 15px 20px;\n        box-sizing: border-box;\n        transition: height 0.3s ease;\n      }\n\n      .now-ai-chat-widget.keyboard-visible {\n        height: 40vh;\n        max-height: 40vh;\n        padding-bottom: 8px;\n      }\n\n      .now-ai-chat-widget.keyboard-visible .now-ai-chat-messages {\n        max-height: calc(40vh - 100px);\n      }\n\n      .now-ai-chat-input-container {\n        margin-bottom: 12px;\n        padding: 0;\n      }\n\n      .now-ai-collapse-button {\n       right: -4px;\n        top: 6px;\n      }\n\n      .now-ai-minimize-button {\n        right: 24px;\n        top: 6px;\n      }\n\n      .now-ai-collapsed-close {\n        width: 16px;\n        height: 16px;\n        top: -8px;\n        right: -8px;\n        z-index: 20002;\n      }\n\n      .now-ai-collapsed-close svg {\n        width: 10px;\n        height: 10px;\n      }\n\n      .now-ai-chat-widget.collapsed {\n        width: 74px;\n        height: 120px;\n        border-radius: 12px;\n        left: auto;\n        right: 20px;\n      }\n\n      .now-ai-chat-widget.collapsed.mobile-lg {\n        width: 142px;\n        height: 230px;\n      }\n\n      .now-ai-chat-widget.super-collapsed {\n        width: 48px;\n        height: 48px;\n        border-radius: 8px;\n        overflow: hidden;\n        padding: 0;\n        box-shadow: 0px 4px 4px 0px rgba(0, 0, 0, 0.25);\n        transition: all 0.3s ease;\n        border: 1px solid #82A1FF;\n      }\n\n      .now-ai-chat-widget.super-collapsed .now-ai-avatar {\n        width: 100%;\n        height: 100%;\n        border-radius: 8px;\n        object-fit: cover;\n        transform: scale(1.02);\n        box-shadow: 0px 2px 4px 0px rgba(0, 0, 0, 0.2);\n      }\n\n      .now-ai-chat-widget.super-collapsed .now-ai-online-status {\n        position: absolute;\n        top: 6px;\n        bottom: -4px;\n        left: 8px;\n        transform: translateX(-50%);\n        padding: 0;\n        width: 10px;\n        height: 10px;\n        background-color: transparent;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .now-ai-chat-widget.super-collapsed .now-ai-online-status.show {\n        opacity: 1;\n      }\n\n      .now-ai-chat-widget.super-collapsed .now-ai-online-text {\n        display: none;\n      }\n\n      .now-ai-chat-widget.super-collapsed .now-ai-online-dot {\n        font-size: 10px;\n      }\n\n      .now-ai-chat-widget.super-collapsed .now-ai-collapsed-close {\n        display: none;\n      }\n\n      /* Add hover effect to super-collapsed widget */\n      .now-ai-chat-widget.super-collapsed:hover {\n        transform: scale(1.05);\n        box-shadow: 0px 6px 8px 0px rgba(0, 0, 0, 0.3);\n        cursor: pointer;\n      }\n\n      .now-ai-chat-widget.collapsed.bottom-right,\n      .now-ai-chat-widget.super-collapsed.bottom-right {\n        animation: slideInRight 0.8s cubic-bezier(0.19, 1, 0.22, 1);\n        right: 20px;\n      }\n\n      /* Specific styling for super-collapsed bottom-right position */\n      .now-ai-chat-widget.super-collapsed.bottom-right {\n        right: 16px;\n      }\n\n      /* Mobile styles for chat body in expanded state */\n      .now-ai-chat-widget:not(.collapsed):not(.super-collapsed) .now-ai-chat-body {\n        overflow-x: hidden;\n        padding: 8px 8px;\n      }\n\n      .now-ai-chat-widget.now-gg {\n        position: relative !important;\n        width: 100% !important;\n        height: 100% !important;\n        right: auto !important;\n        bottom: auto !important;\n        left: auto !important;\n        top: auto !important;\n      }\n\n      .now-ai-new-button {\n        position: absolute;\n        top: 12px;\n        right: 12px;\n        width: 24px;\n        height: 24px;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        transition: transform 0.3s ease, background-color 0.2s ease;\n        background-color: rgba(255, 255, 255, 0.2);\n      }\n\n      .now-ai-new-button:hover {\n        background-color: rgba(255, 255, 255, 0.3);\n      }\n\n      .now-ai-new-button svg {\n        width: 18px;\n        height: 18px;\n        fill: none;\n        stroke: white;\n        stroke-width: 2;\n        stroke-linecap: round;\n        stroke-linejoin: round;\n      }\n    }\n  `;function injectStyles(){const styleElement=document.createElement("style");styleElement.innerHTML=styles;document.head.appendChild(styleElement)}function optimizeImageUrl(imageUrl){if(!imageUrl)return imageUrl;if(imageUrl.startsWith("https://cdn.now.gg")||imageUrl.startsWith("https://cdn.wsup.ai")){return`https://cdn.wsup.ai/assets-opt/_next/image?url=${encodeURIComponent(imageUrl)}&w=256&q=80`}else if(imageUrl&&(imageUrl.endsWith(".jpg")||imageUrl.endsWith(".jpeg")||imageUrl.endsWith(".png"))){const hasParams=imageUrl.includes("?");return`${imageUrl}${hasParams?"&":"?"}format=webp`}return imageUrl}function preloadImage(url){return new Promise(((resolve,reject)=>{const img=new Image;img.onload=()=>resolve(url);img.onerror=()=>reject(new Error(`Failed to load image: ${url}`));img.src=url}))}function isDemonicscans(){const currentUrl=window.location.href.toLowerCase();return currentUrl.includes("demonicscans.org")}function isPartnerNowgg(){return config.partner==="now.gg"}const placeholderImageSvg=`data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23cccccc'/%3E%3C/svg%3E`;async function createChatWidget(){const container=document.createElement("div");container.className=isPartnerNowgg()?"now-ai-chat-widget now-gg":`now-ai-chat-widget ${config.position}`;container.id="now-ai-chat-widget";if(isPartnerNowgg()){container.style.position="relative";container.style.width="100%";container.style.height="100%";container.style.right="unset";container.style.bottom="unset";container.style.left="unset";container.style.top="unset"}container.style.setProperty("--character-avatar-url",`url("${placeholderImageSvg}")`);if(config.characterDetails&&config.characterDetails.characterImageUrl){preloadImage(config.characterDetails.characterImageUrl).then((url=>{container.style.setProperty("--character-avatar-url",`url("${url}")`)})).catch((error=>{console.error("Failed to load optimized image:",error);if(config.characterDetails.characterImageUrlOriginal){container.style.setProperty("--character-avatar-url",`url("${config.characterDetails.characterImageUrlOriginal}")`)}}))}if(!(isPartnerNowgg()&&!config.isMobile)){container.classList.add("collapsed")}if(config.isMobileLg&&checkMobile()){container.classList.add("mobile-lg")}const collapsedLogo=document.createElement("div");collapsedLogo.className="now-ai-collapsed-logo";const collapsedLogoLink=document.createElement("a");collapsedLogoLink.href="https://wsup.ai";collapsedLogoLink.target="_blank";collapsedLogoLink.style.display="block";collapsedLogoLink.addEventListener("click",(function(e){e.stopPropagation()}));const collapsedLogoImg=document.createElement("img");collapsedLogoImg.src="https://wsup.ai/_next/static/media/whiteHeaderLogo.3941e67c.png";collapsedLogoImg.alt="wsup.ai";collapsedLogoLink.appendChild(collapsedLogoImg);collapsedLogo.appendChild(collapsedLogoLink);container.appendChild(collapsedLogo);let uaId=localStorage.getItem("wsup_uaId");if(!uaId){uaId=`ua-${generateUUID()}`;localStorage.setItem("wsup_uaId",uaId)}setTimeout((()=>{const onlineStatus=document.getElementById("now-ai-online-status");if(onlineStatus){onlineStatus.classList.add("show")}}),1500);container.addEventListener("click",(function(e){if(this.classList.contains("super-collapsed")){e.stopPropagation();const onlineStatus=document.getElementById("now-ai-online-status");if(onlineStatus){onlineStatus.classList.remove("show")}this.classList.remove("super-collapsed");this.classList.remove("collapsed");toggleCollapse()}}));if(config.isMobile||config.shouldHideOnClose){const collapsedCloseButton=document.createElement("div");collapsedCloseButton.className="now-ai-collapsed-close";collapsedCloseButton.id="now-ai-collapsed-close";collapsedCloseButton.style.opacity="0";collapsedCloseButton.innerHTML=`\n      <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24">\n        <path d="M18 6L6 18"></path>\n        <path d="M6 6L18 18"></path>\n      </svg>\n    `;collapsedCloseButton.onclick=function(e){e.stopPropagation();const widget=document.getElementById("now-ai-chat-widget");if(widget){if(isDemonicscans()||config.shouldHideOnClose){widget.style.display="none";return}widget.classList.add("super-collapsed");widget.classList.add("collapsed");widget.style.width="48px";widget.style.height="48px";widget.style.borderRadius="50%";widget.style.border="1px solid #82A1FF";widget.style.boxShadow="0px 4px 4px 0px rgba(0, 0, 0, 0.25)";widget.style.bottom=isDemonicscans()&&config.isMobile?"100px":"16px";widget.style.right="16px";const onlineStatus=document.getElementById("now-ai-online-status");setTimeout((()=>{if(onlineStatus){onlineStatus.classList.add("show")}const collapsedLogo=document.querySelector(".now-ai-collapsed-logo");if(collapsedLogo){collapsedLogo.classList.add("show")}}),300)}};container.appendChild(collapsedCloseButton)}const chatBubble=document.createElement("div");chatBubble.className="now-ai-chat-bubble";chatBubble.id="now-ai-chat-bubble";const bubbleContent=document.createElement("div");bubbleContent.className="now-ai-bubble-content";const characterName=document.createElement("div");characterName.className="now-ai-bubble-character-name";characterName.textContent=config.characterDetails.characterName;const greetingMessage=document.createElement("div");greetingMessage.className="now-ai-bubble-greeting";greetingMessage.textContent=config.characterDetails.greetingMessage;bubbleContent.appendChild(characterName);bubbleContent.appendChild(greetingMessage);chatBubble.appendChild(bubbleContent);container.appendChild(chatBubble);const onlineStatus=document.createElement("div");onlineStatus.className="now-ai-online-status";onlineStatus.id="now-ai-online-status";const onlineDot=document.createElement("span");onlineDot.className="now-ai-online-dot";onlineDot.textContent="ðŸŸ¢";const onlineText=document.createElement("span");onlineText.className="now-ai-online-text";onlineText.textContent=" Online";const attribution=document.createElement("a");attribution.href="https://wsup.ai";attribution.textContent="Powered by wsup.ai";attribution.style.display="none";onlineStatus.appendChild(attribution);onlineStatus.appendChild(onlineDot);onlineStatus.appendChild(onlineText);container.appendChild(onlineStatus);setTimeout((()=>{const bubble=document.getElementById("now-ai-chat-bubble");const widget=document.getElementById("now-ai-chat-widget");if(bubble&&widget){if(widget.classList.contains("collapsed")||widget.classList.contains("super-collapsed")){bubble.classList.add("show")}setTimeout((()=>{bubble.classList.remove("show");const onlineStatus=document.getElementById("now-ai-online-status");const collapsedClose=document.getElementById("now-ai-collapsed-close");const collapsedLogo=document.querySelector(".now-ai-collapsed-logo");if(widget.classList.contains("collapsed")){setTimeout((()=>{if(onlineStatus){onlineStatus.classList.add("show")}if(collapsedClose){collapsedClose.style.opacity="1"}if(collapsedLogo&&!widget.classList.contains("super-collapsed")){collapsedLogo.classList.add("show")}}),300)}}),8e3)}else{console.log("Chat bubble element not found")}}),1e3);if(config.position==="bottom-right"&&!isPartnerNowgg()){setTimeout((()=>{container.style.animation="slideInRight 0.8s cubic-bezier(0.19, 1, 0.22, 1)"}),100)}const header=document.createElement("div");header.className="now-ai-chat-header";header.onclick=function(e){if(isPartnerNowgg()&&!config.isMobile){return}const widget=document.getElementById("now-ai-chat-widget");if(widget){if(widget.classList.contains("collapsed")){const onlineStatus=document.getElementById("now-ai-online-status");if(onlineStatus){onlineStatus.classList.remove("show")}const chatBubble=document.getElementById("now-ai-chat-bubble");if(chatBubble){chatBubble.classList.remove("show")}if(isDemonicscans()||config.shouldHideOnClose){widget.classList.remove("collapsed");const minimizeButton=document.querySelector(".now-ai-minimize-button");if(minimizeButton){minimizeButton.style.display="flex"}widget.style.backgroundImage=`linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2)), var(--character-avatar-url)`;widget.style.backgroundSize="cover";widget.style.backgroundPosition="center top";if(!isPartnerNowgg()){widget.style.animation="fadeIn 0.3s ease-out"}if(config.isMobile){widget.style.width="100%";widget.style.height="80vh";widget.style.left="0";widget.style.right="0";widget.style.bottom=isDemonicscans()?"100px":"0";widget.style.borderRadius="16px 16px 0 0";widget.style.padding="10px 15px"}else{widget.style.width="268px";widget.style.height="480px";widget.style.borderRadius="24px";widget.style.right="20px";widget.style.bottom=isDemonicscans()&&config.isMobile?"100px":"20px";widget.style.border="2px solid #82A1FF"}setTimeout((()=>{const messagesContainer=document.getElementById("now-ai-chat-messages");if(messagesContainer){scrollMessagesToBottom()}}),300)}else{toggleCollapse()}}}};const headerInfo=document.createElement("div");headerInfo.className="now-ai-header-info";const avatar=document.createElement("img");avatar.className="now-ai-avatar";avatar.alt="wsup.ai";avatar.style.cursor=config.sessionInfo?.body?.chatSessionId?"pointer":"default";avatar.src=placeholderImageSvg;avatar.loading="lazy";avatar.decoding="async";setTimeout((()=>{avatar.src=config.characterDetails.characterImageUrl}),100);avatar.onclick=function(e){const widget=document.getElementById("now-ai-chat-widget");const chatSessionId=config.sessionInfo?.body?.chatSessionId;const characterId=config.characterDetails?.characterId;const userId=config.userId;if(!chatSessionId||!characterId||!userId){console.warn("Avatar clicked but missing required parameters for sessionBridge",{chatSessionId:!!chatSessionId,characterId:!!characterId,userId:!!userId});return}if(widget&&!widget.classList.contains("collapsed")&&chatSessionId){e.stopPropagation();reportEvent({eventName:"feEmbedWidgetProfileClicked",extraData:{pageUrl:window.location.origin+window.location.pathname,pageTitle:document.title,landingUrl:`${config.apiHost}/chats?chatId=${chatSessionId}&charId=${characterId}&utm_source=embedWidget&utm_medium=${window.location.hostname}&utm_campaign=roblox-link`}});window.open(`${config.apiHost}/sessionBridge?chatSessionId=${chatSessionId}&userId=${userId}&characterId=${characterId}&utm_source=embedWidget&utm_medium=${window.location.hostname}&utm_campaign=roblox-link`,"_blank")}};const title=document.createElement("div");title.className="now-ai-chat-header-title";title.textContent=config.characterDetails.characterName;const poweredBy=document.createElement("div");poweredBy.className="now-ai-powered-by";const poweredByText=document.createTextNode("POWERED BY ");poweredBy.appendChild(poweredByText);const logoContainer=document.createElement("div");logoContainer.className="now-ai-logo";const logoLink=document.createElement("a");logoLink.href="https://wsup.ai";logoLink.target="_blank";logoLink.style.display="block";logoLink.style.textDecoration="none";logoLink.addEventListener("click",(function(e){e.stopPropagation()}));const logoImg=document.createElement("img");logoImg.src="https://wsup.ai/_next/static/media/whiteHeaderLogo.3941e67c.png";logoImg.alt="wsup.ai";logoImg.style.height="12px";logoImg.style.verticalAlign="middle";logoLink.appendChild(logoImg);logoContainer.appendChild(logoLink);poweredBy.appendChild(logoContainer);headerInfo.appendChild(title);headerInfo.appendChild(poweredBy);const collapseButton=document.createElement("div");collapseButton.className="now-ai-collapse-button";collapseButton.innerHTML=`\n      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">\n      <path d="M18 6L6 18"></path>\n      <path d="M6 6L18 18"></path>\n      </svg>\n    `;collapseButton.onclick=function(e){e.stopPropagation();const currentUrl=window.location.href.toLowerCase();if(isDemonicscans()||config.shouldHideOnClose){const widget=document.getElementById("now-ai-chat-widget");widget.style.display="none";return}toggleCollapse()};const minimizeButton=document.createElement("div");minimizeButton.className="now-ai-minimize-button";const widget=document.getElementById("now-ai-chat-widget");minimizeButton.style.display=(isDemonicscans()||config.shouldHideOnClose)&&widget&&!widget.classList.contains("collapsed")?"flex":"none";minimizeButton.innerHTML=`\n      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">\n        <path d="M20 12H4" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>\n      </svg>\n    `;minimizeButton.onclick=function(e){e.stopPropagation();const widget=document.getElementById("now-ai-chat-widget");if(widget&&!widget.classList.contains("collapsed")){if(isDemonicscans()||config.shouldHideOnClose){widget.classList.add("collapsed");const minimizeButton=document.querySelector(".now-ai-minimize-button");if(minimizeButton){minimizeButton.style.display="none"}widget.style.background="none";if(config.isMobile){if(config.isMobileLg){widget.style.width="142px";widget.style.height="230px"}else{widget.style.width="74px";widget.style.height="120px"}widget.style.borderRadius="12px";widget.style.left="auto";widget.style.right="20px";widget.style.bottom=isDemonicscans()&&config.isMobile?"100px":"20px";widget.style.padding="0"}else{widget.style.width="56px";widget.style.height="90px";widget.style.left="auto";widget.style.right="20px";widget.style.bottom=isDemonicscans()&&config.isMobile?"100px":"20px";widget.style.borderRadius="12px";widget.style.padding="0";widget.style.border="none";widget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.25)";widget.style.border="1px solid #82A1FF"}const onlineStatus=document.getElementById("now-ai-online-status");setTimeout((()=>{if(onlineStatus){onlineStatus.classList.add("show")}const collapsedLogo=document.querySelector(".now-ai-collapsed-logo");if(collapsedLogo){collapsedLogo.classList.add("show")}}),300)}else{toggleCollapse()}}};header.appendChild(avatar);header.appendChild(headerInfo);if(isPartnerNowgg()&&!config.isMobile){const newButton=document.createElement("div");newButton.className="now-ai-new-button";newButton.innerHTML=`\n        <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36" fill="none">\n<foreignObject x="5" y="5" width="36" height="36"><div xmlns="http://www.w3.org/1999/xhtml" style="backdrop-filter:blur(32px);clip-path:url(#bgblur_0_19604_23351_clip_path);height:100%;width:100%"></div></foreignObject><g data-figma-bg-blur-radius="64">\n<path d="M0 18C0 8.05888 8.05888 0 18 0C27.9411 0 36 8.05888 36 18C36 27.9411 27.9411 36 18 36C8.05888 36 0 27.9411 0 18Z" fill="white" fill-opacity="0.1"/>\n<path d="M18 0.5C27.665 0.5 35.5 8.33502 35.5 18C35.5 27.665 27.665 35.5 18 35.5C8.33502 35.5 0.5 27.665 0.5 18C0.5 8.33502 8.33502 0.5 18 0.5Z" stroke="white" stroke-opacity="0.1"/>\n<path d="M18 16.5C19.1028 16.5 20 15.6027 20 14.4999C20 13.3971 19.1028 12.5 18 12.5C16.8972 12.5 16 13.3971 16 14.4999C16 15.6027 16.8972 16.5 18 16.5ZM18 13.222C18.7047 13.222 19.2779 13.7953 19.2779 14.4999C19.2779 15.2047 18.7047 15.778 18 15.778C17.2953 15.778 16.7221 15.2047 16.7221 14.4999C16.7221 13.7953 17.2953 13.222 18 13.222Z" fill="white" stroke="white" stroke-width="0.25"/>\n<path d="M14.3226 21.4933C14.5352 21.5332 14.7397 21.3845 14.778 21.16C15.0588 19.5181 16.4139 18.3264 18 18.3264C19.5862 18.3264 20.9413 19.5181 21.222 21.16C21.2561 21.3597 21.4212 21.5 21.6073 21.5C21.6304 21.5 21.6538 21.4978 21.6774 21.4933C21.8905 21.4529 22.0321 21.238 21.9937 21.0133C21.6458 18.9776 19.9661 17.5 18 17.5C16.034 17.5 14.3544 18.9776 14.0063 21.0133C13.9679 21.238 14.1094 21.4528 14.3226 21.4933Z" fill="white" stroke="white" stroke-width="0.25"/>\n<path d="M10.9479 16.9503C10.749 16.7435 10.4009 16.7435 10.202 16.9503L9.08314 18.1133V17.1829C9.08314 12.169 12.9868 8.11133 17.8104 8.11133C20.6946 8.11133 23.4048 9.58449 25.021 12.0656C25.195 12.3241 25.5183 12.3757 25.7669 12.2207C26.0155 12.0398 26.0653 11.7038 25.9161 11.4453C24.0761 8.67992 21.0427 7 17.8104 7C12.4149 7 8.01399 11.5746 8.01399 17.1829V18.1133L6.8951 16.9503C6.69619 16.7435 6.3481 16.7435 6.14918 16.9503C5.95027 17.1571 5.95027 17.5189 6.14918 17.7256L8.18803 19.8449C8.28749 19.9483 8.41181 20 8.56099 20C8.71018 20 8.8345 19.9483 8.93395 19.8449L10.9728 17.7256C11.1717 17.5189 11.1717 17.1829 10.9479 16.9503Z" fill="white"/>\n<path d="M29.8539 17.2698L27.8173 15.1548C27.6186 14.9484 27.2709 14.9484 27.0722 15.1548L25.0356 17.2698C24.8369 17.4762 24.8369 17.8373 25.0356 18.0437C25.2343 18.25 25.582 18.25 25.7807 18.0437L26.8984 16.8829V17.8115C26.8984 22.8155 22.999 26.8651 18.1806 26.8651C15.2996 26.8651 12.5923 25.3948 10.978 22.9187C10.8041 22.6607 10.4812 22.6091 10.2328 22.7639C9.98448 22.9444 9.9348 23.2798 10.0838 23.5377C11.9218 26.3234 14.9518 28 18.1806 28C23.5702 28 27.9663 23.4345 27.9663 17.8373V16.9087L29.084 18.0694C29.1834 18.1726 29.3324 18.2242 29.4566 18.2242C29.5807 18.2242 29.7298 18.1726 29.8291 18.0694C30.0526 17.8373 30.0526 17.502 29.8539 17.2698Z" fill="white"/>\n</g>\n<defs>\n<clipPath id="bgblur_0_19604_23351_clip_path" transform="translate(64 64)"><path d="M0 18C0 8.05888 8.05888 0 18 0C27.9411 0 36 8.05888 36 18C36 27.9411 27.9411 36 18 36C8.05888 36 0 27.9411 0 18Z"/>\n</clipPath></defs>\n</svg>\n      `;newButton.onclick=async e=>{e.stopPropagation();if(newButton.classList.contains("disabled")){return}newButton.classList.add("disabled");newButton.style.opacity="0.5";newButton.style.cursor="not-allowed";newButton.style.pointerEvents="none";try{const sessionInfo=await startSession(true);if(sessionInfo){config.sessionInfo=sessionInfo;updateSessionReferences()}}catch(error){console.error("Failed to start new session:",error)}const newCharacterDetails=await fetchCharacterDetails();if(newCharacterDetails){updateCharacterUI()}newButton.classList.remove("disabled");newButton.style.opacity="";newButton.style.cursor="";newButton.style.pointerEvents=""};header.appendChild(newButton)}else{if(isDemonicscans()||config.shouldHideOnClose){header.appendChild(minimizeButton)}header.appendChild(collapseButton)}const body=document.createElement("div");body.className="now-ai-chat-body";const messages=document.createElement("div");messages.className="now-ai-chat-messages";messages.id="now-ai-chat-messages";const typingIndicator=document.createElement("div");typingIndicator.className="now-ai-typing-indicator";typingIndicator.id="now-ai-typing-indicator";const typingText=document.createElement("span");typingText.className="now-ai-typing-text";typingText.textContent=`${config.characterDetails.characterName} is typing`;const bouncingDots=document.createElement("div");bouncingDots.className="now-ai-bouncing-dots";for(let i=0;i<3;i++){const dot=document.createElement("div");dot.className="now-ai-dot";bouncingDots.appendChild(dot)}typingIndicator.appendChild(typingText);typingIndicator.appendChild(bouncingDots);const inputContainer=document.createElement("div");inputContainer.className="now-ai-chat-input-container";const input=document.createElement("input");input.className="now-ai-chat-input";input.type="text";input.placeholder="Type your message...";input.id="now-ai-chat-input";input.addEventListener("keypress",(function(e){if(e.key==="Enter"&&!e.shiftKey){e.preventDefault();replyMessage()}}));input.addEventListener("focus",(function(){if(config.isMobile){const chatWidget=document.getElementById("now-ai-chat-widget");if(chatWidget){const messagesContainer=document.getElementById("now-ai-chat-messages");if(messagesContainer){setTimeout((()=>{scrollMessagesToBottom();setTimeout((()=>{this.scrollIntoView({behavior:"smooth",block:"center"})}),300)}),100)}}}}));const replyButton=document.createElement("button");replyButton.className="now-ai-chat-submit";replyButton.innerHTML=`\n      <svg xmlns="http://www.w3.org/2000/svg" width="21" height="20" viewBox="0 0 21 20" fill="none">\n        <mask id="mask0_13020_2376" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="21" height="20">\n          <path d="M17.1056 9.55279L3.93958 2.96979C3.56301 2.78151 3.13655 3.11448 3.22788 3.52547L4.5 9.25L10.5 10L4.5 10.75L3.22788 16.4745C3.13655 16.8855 3.56301 17.2185 3.93958 17.0302L17.1056 10.4472C17.4741 10.263 17.4741 9.73705 17.1056 9.55279Z" fill="white"/>\n        </mask>\n        <g mask="url(#mask0_13020_2376)">\n          <rect width="20" height="20" transform="translate(0.5)" fill="white"/>\n        </g>\n      </svg>\n    `;replyButton.onclick=replyMessage;inputContainer.appendChild(input);inputContainer.appendChild(replyButton);const wsupContainer=document.createElement("div");wsupContainer.className="now-ai-wsup-container";wsupContainer.id="now-ai-wsup-container";const wsupLogo=document.createElement("img");wsupLogo.className="now-ai-wsup-logo";wsupLogo.src="https://wsup.ai/_next/static/media/whiteHeaderLogo.3941e67c.png";wsupLogo.alt="wsup.ai logo";const continueButton=document.createElement("button");continueButton.className="now-ai-continue-button";const chatSessionId=config.sessionInfo?.body?.chatSessionId||"";const characterId=config.characterDetails?.characterId||"";const userId=config.userId||"";if(chatSessionId&&characterId){continueButton.dataset.href=`${config.apiHost}/sessionBridge?chatSessionId=${chatSessionId}&userId=${userId}&characterId=${characterId}&utm_source=embedWidget&utm_medium=${window.location.hostname}&utm_campaign=roblox-link`}else{console.warn("Continue button created but missing required parameters",{chatSessionId:!!chatSessionId,characterId:!!characterId,userId:!!userId})}continueButton.textContent=config.isMobile?"Continue chatting":"Continue";continueButton.addEventListener("click",(function(event){event.preventDefault();const chatSessionId=config.sessionInfo?.body?.chatSessionId;const characterId=config.characterDetails?.characterId;const userId=config.userId;if(!chatSessionId||!characterId){console.error("Continue button clicked but missing required parameters",{chatSessionId:!!chatSessionId,characterId:!!characterId,userId:!!userId});return}reportEvent({eventName:"feEmbedWidgetCTAClicked",extraData:{pageUrl:window.location.origin+window.location.pathname,pageTitle:document.title,landingUrl:`${config.apiHost}/chats?chatId=${chatSessionId}&charId=${characterId}&utm_source=embedWidget&utm_medium=${window.location.hostname}&utm_campaign=roblox-link`}});window.open(this.dataset.href,"_blank")}));const externalIcon=document.createElementNS("http://www.w3.org/2000/svg","svg");externalIcon.setAttribute("width","16");externalIcon.setAttribute("height","16");externalIcon.setAttribute("viewBox","0 0 16 16");externalIcon.setAttribute("fill","none");externalIcon.innerHTML=`\n      <mask id="mask0_11635_985" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="16" height="16">\n      <path d="M3.33801 12.6667L12.0047 4" stroke="black" stroke-linecap="round"/>\n      <path d="M6.00476 3.33331H12.1714C12.4476 3.33331 12.6714 3.55717 12.6714 3.83331V9.99998" stroke="black" stroke-linecap="round"/>\n      </mask>\n      <g mask="url(#mask0_11635_985)">\n      <rect width="16" height="16" fill="white"/>\n      </g>\n    `;continueButton.appendChild(externalIcon);wsupContainer.appendChild(wsupLogo);wsupContainer.appendChild(continueButton);body.appendChild(messages);body.appendChild(typingIndicator);body.appendChild(inputContainer);body.appendChild(wsupContainer);const chatButton=document.createElement("div");chatButton.className="now-ai-chat-button now-ai-hidden";chatButton.innerHTML="<i>ðŸ’¬</i>";chatButton.onclick=toggleChat;container.appendChild(header);container.appendChild(body);const targetContainer=config.containerSelector?document.querySelector(config.containerSelector):document.body;if(targetContainer){targetContainer.appendChild(container);targetContainer.appendChild(chatButton)}if(config.isChatLimitExceeded){showWsupContainer()}if(config.characterDetails.description){addMessage(config.characterDetails.description,"bot",true)}if(config.sessionInfo?.body?.chatHistoryList&&config.sessionInfo?.body?.chatHistoryList?.length>0){config.sessionInfo.body.chatHistoryList.forEach((message=>{if(message.type==="ai"){addMessage(message.data.content,"bot")}else if(message.type==="human"){addMessage(message.data.content,"user")}}));const messagesContainer=document.getElementById("now-ai-chat-messages");if(messagesContainer){scrollMessagesToBottom()}}else{addMessage(config.characterDetails.greetingMessage,"bot")}reportEvent({eventName:"feEmbedWidgetViewed",extraData:{pageUrl:window.location.origin+window.location.pathname,pageTitle:document.title}})}function updateSessionReferences(){const continueButton=document.querySelector(".now-ai-continue-button");if(continueButton){const chatSessionId=config.sessionInfo?.body?.chatSessionId||"";const userId=config.userId||"";const characterId=config.characterDetails?.characterId||"";if(!chatSessionId||!userId||!characterId){console.warn("updateSessionReferences: Missing required parameters",{chatSessionId:!!chatSessionId,userId:!!userId,characterId:!!characterId});return}continueButton.dataset.href=`${config.apiHost}/sessionBridge?chatSessionId=${chatSessionId}&userId=${userId}&characterId=${characterId}&utm_source=embedWidget&utm_medium=${window.location.hostname}&utm_campaign=roblox-link`}const avatar=document.querySelector(".now-ai-avatar");if(avatar){avatar.style.cursor=config.sessionInfo?.body?.chatSessionId?"pointer":"default"}}function updateCharacterUI(){if(config.isChatLimitExceeded){config.isChatLimitExceeded=false;hideWsupContainer()}const headerTitle=document.querySelector(".now-ai-chat-header-title");if(headerTitle){headerTitle.textContent=config.characterDetails.characterName}const avatar=document.querySelector(".now-ai-avatar");if(avatar&&config.characterDetails.characterImageUrl){avatar.src=config.characterDetails.characterImageUrl}const bubbleCharacterName=document.querySelector(".now-ai-bubble-character-name");if(bubbleCharacterName){bubbleCharacterName.textContent=config.characterDetails.characterName}const bubbleGreeting=document.querySelector(".now-ai-bubble-greeting");if(bubbleGreeting){bubbleGreeting.textContent=config.characterDetails.greetingMessage}const widget=document.getElementById("now-ai-chat-widget");if(widget&&config.characterDetails.characterImageUrl){const optimizedImageUrl=optimizeImageUrl(config.characterDetails.characterImageUrl);preloadImage(optimizedImageUrl).then((url=>{widget.style.setProperty("--character-avatar-url",`url("${url}")`)})).catch((error=>{console.error("Failed to load optimized image:",error);if(config.characterDetails.characterImageUrlOriginal){widget.style.setProperty("--character-avatar-url",`url("${config.characterDetails.characterImageUrlOriginal}")`)}}))}const typingText=document.querySelector(".now-ai-typing-text");if(typingText){typingText.textContent=`${config.characterDetails.characterName} is typing`}const descriptionTitle=document.querySelector(".now-ai-description-title");if(descriptionTitle){descriptionTitle.textContent=`About ${config.characterDetails.characterName}`}const messagesContainer=document.getElementById("now-ai-chat-messages");if(messagesContainer){messagesContainer.innerHTML="";if(config.characterDetails.description){addMessage(config.characterDetails.description,"bot",true)}if(config.characterDetails.greetingMessage){addMessage(config.characterDetails.greetingMessage,"bot")}}updateSessionReferences()}function toggleChat(){const widget=document.getElementById("now-ai-chat-widget");const chatButton=document.querySelector(".now-ai-chat-button");if(!widget||!chatButton)return;if(widget.classList.contains("minimized")){widget.classList.remove("minimized");chatButton.classList.add("now-ai-hidden")}else{widget.classList.add("minimized");chatButton.classList.remove("now-ai-hidden")}}function toggleCollapse(){const widget=document.getElementById("now-ai-chat-widget");if(widget){if(widget.style.display==="none"){widget.style.display="flex";widget.classList.add("collapsed");return}widget.style.animation="none";void widget.offsetWidth;if(widget.classList.contains("super-collapsed")){widget.classList.remove("collapsed");widget.classList.remove("super-collapsed")}else{const wasCollapsed=widget.classList.contains("collapsed");widget.classList.toggle("collapsed");widget.classList.remove("super-collapsed")}const chatBubble=document.getElementById("now-ai-chat-bubble");const onlineStatus=document.getElementById("now-ai-online-status");const crossButton=document.getElementById("now-ai-collapsed-close");if(chatBubble&&chatBubble.classList.contains("show")&&!widget.classList.contains("collapsed")&&!widget.classList.contains("super-collapsed")){chatBubble.classList.remove("show")}if(crossButton&&config.isMobile){if(!widget.classList.contains("collapsed")){crossButton.style.opacity="0"}else if(widget.classList.contains("collapsed")&&!widget.classList.contains("super-collapsed")){const bubbleIsShowing=chatBubble&&chatBubble.classList.contains("show");if(!bubbleIsShowing){setTimeout((()=>{crossButton.style.opacity="1";if(onlineStatus&&!bubbleIsShowing){onlineStatus.classList.add("show")}const collapsedLogo=document.querySelector(".now-ai-collapsed-logo");if(collapsedLogo&&!bubbleIsShowing){collapsedLogo.classList.add("show")}}),300)}}}if(!widget.classList.contains("collapsed")&&!widget.classList.contains("super-collapsed")){if(onlineStatus){onlineStatus.classList.remove("show")}if(chatBubble){chatBubble.classList.remove("show")}const collapsedLogo=document.querySelector(".now-ai-collapsed-logo");if(collapsedLogo){collapsedLogo.classList.remove("show")}const minimizeButton=document.querySelector(".now-ai-minimize-button");if(minimizeButton&&(isDemonicscans()||config.shouldHideOnClose)){minimizeButton.style.display="flex"}widget.style.backgroundImage=`linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2)), var(--character-avatar-url)`;widget.style.backgroundSize="cover";widget.style.backgroundPosition="center top";if(!isPartnerNowgg()){widget.style.animation="fadeIn 0.3s ease-out"}if(config.isMobile){widget.style.width="100%";widget.style.height="80vh";widget.style.left="0";widget.style.right="0";widget.style.bottom=isDemonicscans()?"100px":"0";widget.style.borderRadius="16px 16px 0 0";widget.style.padding="10px 15px"}else{widget.style.width="268px";widget.style.height="480px";widget.style.borderRadius="24px";widget.style.right="20px";widget.style.bottom=isDemonicscans()&&config.isMobile?"100px":"20px";widget.style.border="2px solid #82A1FF"}setTimeout((()=>{const messagesContainer=document.getElementById("now-ai-chat-messages");if(messagesContainer){scrollMessagesToBottom()}}),300)}else{widget.style.background="none";const minimizeButton=document.querySelector(".now-ai-minimize-button");if(minimizeButton){minimizeButton.style.display="none"}if(config.isMobile){if(widget.classList.contains("super-collapsed")){widget.style.width="48px";widget.style.height="48px";widget.style.borderRadius="8px";widget.style.border="1px solid #82A1FF";widget.style.boxShadow="0px 4px 4px 0px rgba(0, 0, 0, 0.25)";widget.style.right="16px";widget.style.bottom=isDemonicscans()?"100px":"16px";setTimeout((()=>{if(onlineStatus){onlineStatus.classList.add("show")}const collapsedLogo=document.querySelector(".now-ai-collapsed-logo");if(collapsedLogo){collapsedLogo.classList.add("show")}}),300)}else{if(config.isMobileLg){widget.style.width="142px";widget.style.height="230px"}else{widget.style.width="74px";widget.style.height="120px"}widget.style.borderRadius="12px"}widget.style.left="auto";widget.style.right="20px";widget.style.bottom=isDemonicscans()?"100px":"20px";widget.style.padding="0"}else{widget.style.width="56px";widget.style.height="90px";widget.style.left="auto";widget.style.right="20px";widget.style.bottom=isDemonicscans()&&config.isMobile?"100px":"20px";widget.style.borderRadius="12px";widget.style.padding="0";widget.style.border="none";widget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.25)";widget.style.border="1px solid #82A1FF"}if(widget.classList.contains("bottom-right")){widget.style.animation="slideInRight 0.8s cubic-bezier(0.19, 1, 0.22, 1)"}setTimeout((()=>{if(onlineStatus&&widget.classList.contains("collapsed")){onlineStatus.classList.add("show")}const collapsedLogo=document.querySelector(".now-ai-collapsed-logo");if(collapsedLogo&&!widget.classList.contains("super-collapsed")){collapsedLogo.classList.add("show")}}),300)}}}async function replyMessage(){const input=document.getElementById("now-ai-chat-input");const replyButton=document.querySelector(".now-ai-chat-submit");if(isDemonicscans()){const msgContent=input?.value.trim();const characterId=config.characterDetails?.characterId;const chatSessionId=config.sessionInfo?.body?.chatSessionId;if(!characterId||!chatSessionId){console.warn("Demonicscans redirect attempted but missing characterId or chatSessionId");return}const redirectUrl=`${config.apiHost}/chats?chatId=${chatSessionId}&charId=${characterId}&utm_source=embedWidget&utm_medium=${window.location.hostname}&utm_campaign=roblox-link${msgContent?`&chat_msg=${encodeURIComponent(msgContent)}`:""}`;reportEvent({eventName:"feEmbedWidgetSendButtonWsupRedirection",extraData:{pageUrl:window.location.origin+window.location.pathname,pageTitle:document.title,landingUrl:redirectUrl}});window.open(redirectUrl,"_blank");input.value="";return}if(!input)return;const message=input.value.trim();if(!message)return;input.classList.add("disabled");replyButton.classList.add("disabled");input.disabled=true;replyButton.disabled=true;input.value="";addMessage(message,"user");showTypingIndicator();try{if(!config.accessToken){await initFirebaseAuth(true);if(!config.accessToken){throw new Error("Failed to authenticate user")}await createOrFetchUser()}if(!config.sessionInfo?.body){const sessionInfo=await startSession();if(!sessionInfo){throw new Error("Failed to create session")}config.sessionInfo=sessionInfo;updateSessionReferences()}if(!config.apiHost||!config.characterDetails.characterId){throw new Error("Missing required configuration for chat API")}const response=await fetch(`${config.apiHost}/ai/api/char/v1/chat`,{method:"POST",headers:{"Content-Type":"application/json",client:"embed-widget",Authorization:`WsupV1 ${config.accessToken}`},body:JSON.stringify({characterId:config.characterDetails.characterId,chatSessionId:config?.sessionInfo?.body?.chatSessionId,requestId:generateUUID(),content:message,chatLimitEnabled:true,source:"embed_widget",pageUrl:window.location.origin+window.location.pathname,pageTitle:document.title})});const data=await response.json();hideTypingIndicator();input.classList.remove("disabled");replyButton.classList.remove("disabled");input.disabled=false;replyButton.disabled=false;input.focus();if(data?.status==="FailureChatLimitExceeded"){config.isChatLimitExceeded=true;showWsupContainer();return}if(data?.body?.answer){addMessage(data.body.answer,"bot")}else{showWsupContainer();return}}catch(error){console.error("Error sending message:",error);hideTypingIndicator();showWsupContainer()}}function showWsupContainer(){const inputContainer=document.querySelector(".now-ai-chat-input-container");const wsupContainer=document.getElementById("now-ai-wsup-container");if(inputContainer&&wsupContainer){inputContainer.classList.add("hidden");wsupContainer.classList.add("active");reportEvent({eventName:"feEmbedWidgetCTAViewed",extraData:{pageUrl:window.location.origin+window.location.pathname,pageTitle:document.title}});const allMessages=document.querySelectorAll(".now-ai-message");allMessages.forEach((message=>{message.classList.add("faded")}))}}function hideWsupContainer(){const inputContainer=document.querySelector(".now-ai-chat-input-container");const wsupContainer=document.getElementById("now-ai-wsup-container");if(inputContainer&&wsupContainer){inputContainer.classList.remove("hidden");wsupContainer.classList.remove("active");const allMessages=document.querySelectorAll(".now-ai-message");allMessages.forEach((message=>{message.classList.remove("faded")}))}}async function startSession(forceNewSession=false){try{const isMobile=checkMobile();const feDeviceType=isMobile?"mobile":"desktop";const feOsName=getOsName();let uaId=localStorage.getItem("wsup_uaId");let uaSessionId=sessionStorage.getItem("wsup_uaSessionId");if(!uaId){uaId=`ua-${generateUUID()}`;localStorage.setItem("wsup_uaId",uaId)}if(!uaSessionId||forceNewSession){uaSessionId=`uasess-${generateUUID()}`;sessionStorage.setItem("wsup_uaSessionId",uaSessionId)}const utmParams=getUtmParams();const response=await fetch(`${config.apiHost}/ai/api/char/v1/session`,{method:"POST",headers:{"Content-Type":"application/json",client:"embed-widget",Authorization:`WsupV1 ${config.accessToken}`},body:JSON.stringify({userId:config.userId,characterId:config.characterDetails.characterId,uaId:uaId,uaSessionId:uaSessionId,feDeviceType:feDeviceType,feOsName:feOsName,pageReferrer:document.referrer||"NA",utmCampaign:utmParams.utmCampaign||"NA",utmSource:utmParams.utmSource||"NA",utmMedium:utmParams.utmMedium||"NA",forceNewSession:forceNewSession})});if(!response.ok){throw new Error(`Failed to start session: ${response.status}`)}const data=await response.json();if(data.status==="Success"){return data}else{throw new Error("Failed to start session: API returned failure status")}}catch(error){console.error("Error starting session:",error);throw error}}async function createOrFetchUser(){try{if(!config.accessToken){console.error("Access token not available for user API call");return null}const utmParams=getUtmParams();const usersPayload={ageRange:"NA",gender:"NA",utmCampaign:utmParams.utmCampaign||"NA",utmSource:utmParams.utmSource||"NA",utmMedium:utmParams.utmMedium||"NA",pageReferrer:document.referrer||"NA",feDeviceType:config.isMobile?"mobile":"desktop",feOsName:getOsName(),source:"embed_widget",sourceUrl:window.location.origin+window.location.pathname};const response=await fetch(`${config.apiHost}/ai/api/char/v1/users`,{method:"POST",headers:{"Content-Type":"application/json",client:"embed-widget",Authorization:`WsupV1 ${config.accessToken}`},body:JSON.stringify(usersPayload)});if(!response.ok){throw new Error(`Failed to create/fetch user: ${response.status}`)}const data=await response.json();if(data.status==="Success"&&data.body&&data.body.user){const{user:user,userCountryCode:userCountryCode}=data.body;config.userId=user.userId;localStorage.setItem("nowAiUserData",JSON.stringify({userId:user.userId,nickName:user.nickName,avatarUrl:user.avatarUrl,gender:user.gender,ageRange:user.ageRange,userCountryCode:userCountryCode}));return user.userId}else{throw new Error("Failed to get user data from API")}}catch(error){console.error("Error creating/fetching user:",error);return null}}function generateUUID(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(c=>(c^crypto.getRandomValues(new Uint8Array(1))[0]&15>>c/4).toString(16)))}function getOsName(){const{userAgent:userAgent}=navigator;if(userAgent.includes("Win"))return"Windows";if(userAgent.includes("Mac"))return"MacOS";if(userAgent.includes("Linux"))return"Linux";if(userAgent.includes("Android"))return"Android";if(userAgent.includes("iOS")||userAgent.includes("iPhone")||userAgent.includes("iPad"))return"iOS";return"Unknown"}function getUtmParams(){const urlParams=new URLSearchParams(window.location.search);return{utmCampaign:urlParams.get("utm_campaign")||sessionStorage.getItem("utmCampaign")||"NA",utmSource:urlParams.get("utm_source")||sessionStorage.getItem("utmSource")||"NA",utmMedium:urlParams.get("utm_medium")||sessionStorage.getItem("utmMedium")||"NA"}}function fetchPageDescription(){const metaDescription=document.querySelector('meta[name="description"]')?.content||"";const ogDescription=document.querySelector('meta[property="og:description"]')?.content||"";let description=metaDescription||ogDescription||"";const isHTML=/<\/?[a-z][\s\S]*>/i.test(description);if(isHTML){const tempDiv=document.createElement("div");tempDiv.innerHTML=description;description=tempDiv.innerText}if(description.length>1200){return description.substring(0,1200)}return description}function fetchPageMetadataWithRetry(maxRetries=3,retryDelay=500){return new Promise((resolve=>{let attempt=0;function tryFetch(){const metaDescription=document.querySelector('meta[name="description"]')?.content||"";const ogDescription=document.querySelector('meta[property="og:description"]')?.content||"";let description=metaDescription||ogDescription||"";if(description&&/<\/?[a-z][\s\S]*>/i.test(description)){const tempDiv=document.createElement("div");tempDiv.innerHTML=description;description=tempDiv.innerText}const pageTitle=document.title;if(description&&pageTitle||attempt>=maxRetries){if(description&&description.length>1200){description=description.substring(0,1200)}resolve({pageTitle:pageTitle,pageDescription:description})}else{attempt++;console.log(`Attempt ${attempt}: Metadata not yet available, retrying...`);setTimeout(tryFetch,retryDelay)}}tryFetch()}))}function scrollMessagesToBottom(smooth=false,partialView=false){const messagesContainer=document.getElementById("now-ai-chat-messages");if(!messagesContainer)return;if(partialView){const botMessages=messagesContainer.querySelectorAll(".now-ai-bot-message");if(botMessages.length>0){const lastBotMessage=botMessages[botMessages.length-1];const containerHeight=messagesContainer.offsetHeight;const partialScroll=lastBotMessage.offsetTop-containerHeight*.6;if(smooth){messagesContainer.scrollTo({top:partialScroll,behavior:"smooth"})}else{messagesContainer.scrollTop=partialScroll}return}}if(smooth){messagesContainer.scrollTo({top:messagesContainer.scrollHeight,behavior:"smooth"})}else{messagesContainer.scrollTop=messagesContainer.scrollHeight}}function addMessage(text,sender,isDescription=false){const messagesContainer=document.getElementById("now-ai-chat-messages");if(!messagesContainer)return;const messageElement=document.createElement("div");messageElement.className=`now-ai-message ${sender==="user"?"now-ai-user-message":"now-ai-bot-message"}`;if(isDescription){messageElement.classList.add("now-ai-description-message");const descriptionHeader=document.createElement("div");descriptionHeader.className="now-ai-description-header";const descriptionTitle=document.createElement("span");descriptionTitle.className="now-ai-description-title";descriptionTitle.textContent=`About ${config.characterDetails.characterName}`;const readMore=document.createElement("div");readMore.className="now-ai-read-more";readMore.textContent="Read More";descriptionHeader.appendChild(descriptionTitle);descriptionHeader.appendChild(readMore);messageElement.appendChild(descriptionHeader);const descriptionContent=document.createElement("div");descriptionContent.className="now-ai-description-content";descriptionContent.textContent=text;readMore.onclick=function(){descriptionContent.classList.toggle("expanded");readMore.textContent=descriptionContent.classList.contains("expanded")?"Read Less":"Read More"};messageElement.appendChild(descriptionContent)}else{if(text.includes("*")||text.match(/https?:\/\/[^\s\]]+/g)){let formattedText=text.replace(/\*(.*?)\*/g,"<em>$1</em>");formattedText=formattedText.replace(/(https?:\/\/[^\s\]]+)/g,'<a href="$1" target="_blank" style="color: inherit; text-decoration: underline; word-break: break-all;">$1</a>');messageElement.innerHTML=formattedText}else{messageElement.textContent=text}}messagesContainer.appendChild(messageElement);updateMessagesLayout();scrollMessagesToBottom(false,sender==="bot")}function updateMessagesLayout(){const messagesContainer=document.getElementById("now-ai-chat-messages");if(!messagesContainer)return;const messages=messagesContainer.querySelectorAll(".now-ai-message");messages.forEach((msg=>msg.style.marginTop=""));setTimeout((()=>{const containerHeight=messagesContainer.clientHeight;const scrollHeight=messagesContainer.scrollHeight;if(containerHeight>scrollHeight&&messages.length>0){const firstMessage=messages[0];const availableSpace=containerHeight-scrollHeight;firstMessage.style.marginTop=`${availableSpace}px`}}),0)}function showTypingIndicator(){const typingIndicator=document.getElementById("now-ai-typing-indicator");if(!typingIndicator)return;typingIndicator.classList.add("active");setTimeout((()=>scrollMessagesToBottom()),10)}function hideTypingIndicator(){const typingIndicator=document.getElementById("now-ai-typing-indicator");if(!typingIndicator)return;typingIndicator.classList.remove("active")}async function fetchEnvVariables(){return"https://wsup.ai"}async function init(){try{config.isMobile=checkMobile();injectFont();injectStyles();await loadFirebase();const envApiHost=await fetchEnvVariables();if(envApiHost){config.apiHost=envApiHost}let uaId=localStorage.getItem("wsup_uaId");if(!uaId){uaId=`ua-${generateUUID()}`;localStorage.setItem("wsup_uaId",uaId)}reportEvent({eventName:"feEmbedWidgetScriptLoaded"});const characterDetails=await fetchCharacterDetails();if(!characterDetails||!characterDetails.characterId){console.warn("Chat widget initialization skipped: No character ID available");return}const token=await initFirebaseAuth(false);if(token){console.log("Existing user found, setting up session");await createOrFetchUser();try{const sessionInfo=await startSession();if(sessionInfo){config.sessionInfo=sessionInfo;updateSessionReferences();console.log("Session started successfully for existing user")}}catch(error){console.error("Failed to start session for existing user:",error)}}else{console.log("No existing user, session will be created when user sends first message")}await createChatWidget();if(isDemonicscans()&&config.isMobile){const chatWidget=document.getElementById("now-ai-chat-widget");if(chatWidget){chatWidget.style.bottom="100px"}}const debounceResize=debounce(handleResize,250);window.addEventListener("resize",debounceResize);initialWindowHeight=window.innerHeight;window.addEventListener("focusin",(function(e){if(e.target.classList&&e.target.classList.contains("now-ai-chat-input")&&config.isMobile){checkKeyboardVisibility()}}));window.addEventListener("focusout",(function(e){if(e.target.classList&&e.target.classList.contains("now-ai-chat-input")&&config.isMobile){setTimeout((()=>{checkKeyboardVisibility()}),300)}}))}catch(error){console.error("Error initializing chat widget:",error)}}function debounce(func,wait){let timeout;return function executedFunction(...args){const later=()=>{clearTimeout(timeout);func(...args)};if(timeout!==undefined){clearTimeout(timeout)}timeout=setTimeout(later,wait)}}let isKeyboardVisible=false;let initialWindowHeight=window.innerHeight;function checkKeyboardVisibility(){const heightReduction=initialWindowHeight-window.innerHeight;const keyboardThreshold=initialWindowHeight*.15;const previousKeyboardState=isKeyboardVisible;isKeyboardVisible=config.isMobile&&heightReduction>keyboardThreshold;if(isKeyboardVisible!==previousKeyboardState){adjustUIForKeyboard(isKeyboardVisible)}}function adjustUIForKeyboard(isVisible){const chatWidget=document.getElementById("now-ai-chat-widget");if(!chatWidget||chatWidget.classList.contains("collapsed"))return;const messagesContainer=document.getElementById("now-ai-chat-messages");const input=document.getElementById("now-ai-chat-input");if(isVisible){chatWidget.style.height="40vh";chatWidget.classList.add("keyboard-visible");if(input){setTimeout((()=>{input.scrollIntoView({behavior:"smooth",block:"center"})}),300)}if(messagesContainer){scrollMessagesToBottom()}}else{chatWidget.style.height="80vh";chatWidget.classList.remove("keyboard-visible")}}function handleResize(){const wasMobile=config.isMobile;config.isMobile=checkMobile();if(isDemonicscans()&&config.isMobile){const chatWidget=document.getElementById("now-ai-chat-widget");if(chatWidget){chatWidget.style.bottom="100px"}}if(wasMobile!==config.isMobile){initialWindowHeight=window.innerHeight}checkKeyboardVisibility();if(wasMobile!==config.isMobile){const chatWidget=document.getElementById("now-ai-chat-widget");if(chatWidget){if(config.isMobile&&!chatWidget.classList.contains("collapsed")){chatWidget.style.width="100%";chatWidget.style.height="80vh";chatWidget.style.left="0";chatWidget.style.right="0";chatWidget.style.bottom=isDemonicscans()&&config.isMobile?"100px":"0";chatWidget.style.borderRadius="16px 16px 0 0";chatWidget.style.padding="10px 15px";const collapseButton=document.querySelector(".now-ai-collapse-button");if(collapseButton){collapseButton.style.right="-4px";collapseButton.style.top="6px"}const minimizeButton=document.querySelector(".now-ai-minimize-button");if(minimizeButton&&isDemonicscans()){minimizeButton.style.right="24px";minimizeButton.style.top="6px"}const inputContainer=document.querySelector(".now-ai-chat-input-container");if(inputContainer){inputContainer.style.marginBottom="10px";inputContainer.style.padding="0"}}else if(!config.isMobile&&!chatWidget.classList.contains("collapsed")){chatWidget.style.width="268px";chatWidget.style.height="480px";chatWidget.style.left="auto";chatWidget.style.right="20px";chatWidget.style.bottom=isDemonicscans()&&config.isMobile?"100px":"20px";chatWidget.style.borderRadius="24px";const collapseButton=document.querySelector(".now-ai-collapse-button");if(collapseButton){collapseButton.style.right="10px";collapseButton.style.top="12px"}const minimizeButton=document.querySelector(".now-ai-minimize-button");if(minimizeButton&&isDemonicscans()){minimizeButton.style.right="35px";minimizeButton.style.top="12px"}const inputContainer=document.querySelector(".now-ai-chat-input-container");if(inputContainer){inputContainer.style.marginBottom="0";inputContainer.style.padding="0"}}}}}if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",init)}else{init()}})();